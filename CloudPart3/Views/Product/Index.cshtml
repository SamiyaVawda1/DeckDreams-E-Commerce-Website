@model IEnumerable<CloudPart3.Models.Product>

@{
    ViewData["Title"] = "Products page";
}

<h1 class="productsHeading">Skateboards</h1>
<br>

@if (User.IsInRole("Admin"))
{
    <h3 class="addProductHeading">Click the button below to add a product for sale: </h3>
    <a href="@Url.Action("Create", "Product")" class="btn btn-primary">Add a product</a>
    <br>
    <br>
}

<!--this is to display the products in cards-->
<div class="row">
    @foreach (var product in Model)
    {
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <img src="@product.ImageURL" class="card-img-top" alt="@product.productName" style="height: 550px; object-fit: cover;">
                <div class="card-body">
                    <h5 class="card-title">@product.productName</h5>
                    <p class="card-text">@product.productDescription</p>
                    <p class="card-text"><strong>Price: R @product.productPrice</strong></p>
                    <button onclick="addToCart('@product.productID')" class="btnAddToCart">Add to Cart</button>

                    @if (User.IsInRole("Admin"))
                    {
                        <!--edit and delete buttons for admin-->
                        <a href="@Url.Action("Edit", "Product", new { id = product.productID })" class="btn btn-warning">Edit</a>
                        <a href="@Url.Action("Delete", "Product", new { id = product.productID })" class="btn btn-danger">Delete</a>
                    }
                </div>
                <div class="card-footer text-muted">
                </div>
            </div>
        </div>
    }
</div>

<!--Add to cart functionality-->
<script>
    function addToCart(productId) {
        $.ajax({
            url: '@Url.Action("AddToCart", "Cart")',
            type: 'POST',
            data: { productId: productId },
            success: function(response) {
                if (response.success) {
                    alert('Item added to cart!');
                } else {
                    alert(response.message || "An unknown error occurred.");
                }
            },
            error: function(xhr, status, error) {
                alert('Error adding item to cart :/');
                console.error(`Status: ${status}, Error: ${error}`);
            }
        });
    }
</script>